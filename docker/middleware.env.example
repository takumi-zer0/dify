# ================================================================================
# Dify Environment Configuration for Dokploy
# ================================================================================
# This is the main environment file for Dify deployment
# FQDN: dify.hyper-typer.xyz (Cloudflare Tunnel enabled)
# Copy this file to .env and update the values as needed

# ------------------------------
# Database Configuration
# ------------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=difyai123456
POSTGRES_DB=dify
PGDATA=/var/lib/postgresql/data/pgdata
PGDATA_HOST_VOLUME=./volumes/db/data

# Database performance tuning
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_SHARED_BUFFERS=128MB
POSTGRES_WORK_MEM=4MB
POSTGRES_MAINTENANCE_WORK_MEM=64MB
POSTGRES_EFFECTIVE_CACHE_SIZE=4096MB

# ------------------------------
# Redis Configuration
# ------------------------------
REDIS_HOST_VOLUME=./volumes/redis/data
REDIS_PASSWORD=difyai123456

# ------------------------------
# Sandbox Configuration
# ------------------------------
SANDBOX_API_KEY=dify-sandbox
SANDBOX_GIN_MODE=release
SANDBOX_WORKER_TIMEOUT=15
SANDBOX_ENABLE_NETWORK=true
SANDBOX_HTTP_PROXY=http://ssrf_proxy:3128
SANDBOX_HTTPS_PROXY=http://ssrf_proxy:3128
SANDBOX_PORT=8194

# ------------------------------
# SSRF Proxy Configuration
# ------------------------------
SSRF_HTTP_PORT=3128
SSRF_COREDUMP_DIR=/var/spool/squid
SSRF_REVERSE_PROXY_PORT=8194
SSRF_SANDBOX_HOST=sandbox

# ------------------------------
# Weaviate Vector Store Configuration
# ------------------------------
WEAVIATE_QUERY_DEFAULTS_LIMIT=25
WEAVIATE_AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=false
WEAVIATE_DEFAULT_VECTORIZER_MODULE=none
WEAVIATE_CLUSTER_HOSTNAME=node1
WEAVIATE_AUTHENTICATION_APIKEY_ENABLED=true
WEAVIATE_AUTHENTICATION_APIKEY_ALLOWED_KEYS=WVF5YThaHlkYwhGUSmCRgsX3tD5ngdN8pkih
WEAVIATE_AUTHENTICATION_APIKEY_USERS=hello@dify.ai
WEAVIATE_AUTHORIZATION_ADMINLIST_ENABLED=true
WEAVIATE_AUTHORIZATION_ADMINLIST_USERS=hello@dify.ai
WEAVIATE_HOST_VOLUME=./volumes/weaviate

# ------------------------------
# Port Configuration
# ------------------------------
EXPOSE_POSTGRES_PORT=5432
EXPOSE_REDIS_PORT=6379
EXPOSE_SANDBOX_PORT=8194
EXPOSE_SSRF_PROXY_PORT=3128
EXPOSE_WEAVIATE_PORT=8080

# ------------------------------
# Plugin Daemon Configuration
# ------------------------------
DB_PLUGIN_DATABASE=dify_plugin
EXPOSE_PLUGIN_DAEMON_PORT=5002
PLUGIN_DAEMON_PORT=5002
PLUGIN_DAEMON_KEY=lYkiYYT6owG+71oLerGzA7GXCgOT++6ovaezWAjpCjf+Sjc3ZtU+qUEi
PLUGIN_DAEMON_URL=http://host.docker.internal:5002
PLUGIN_MAX_PACKAGE_SIZE=52428800
PLUGIN_PPROF_ENABLED=false
PLUGIN_WORKING_PATH=/app/storage/cwd
ENDPOINT_URL_TEMPLATE=http://localhost:5002/e/{hook_id}
PLUGIN_DEBUGGING_PORT=5003
PLUGIN_DEBUGGING_HOST=0.0.0.0
PLUGIN_REMOTE_INSTALLING_HOST=0.0.0.0
PLUGIN_REMOTE_INSTALLING_PORT=5003
EXPOSE_PLUGIN_DEBUGGING_HOST=localhost
EXPOSE_PLUGIN_DEBUGGING_PORT=5003
PLUGIN_DIFY_INNER_API_KEY=QaHbTe77CtuXmsfyhR7+vRjI/+XbV1AaFy691iy+kGDv2Jvy0/eAh8Y1
PLUGIN_DIFY_INNER_API_URL=http://host.docker.internal:5001
MARKETPLACE_ENABLED=true
MARKETPLACE_API_URL=https://marketplace.dify.ai
FORCE_VERIFYING_SIGNATURE=true
PLUGIN_PYTHON_ENV_INIT_TIMEOUT=120
PLUGIN_MAX_EXECUTION_TIMEOUT=600
PIP_MIRROR_URL=

# Plugin Storage Configuration
PLUGIN_STORAGE_TYPE=local
PLUGIN_STORAGE_LOCAL_ROOT=/app/storage
PLUGIN_INSTALLED_PATH=plugin
PLUGIN_PACKAGE_CACHE_PATH=plugin_packages
PLUGIN_MEDIA_CACHE_PATH=assets

# Plugin Cloud Storage (Optional - uncomment and configure if needed)
# PLUGIN_STORAGE_OSS_BUCKET=
# PLUGIN_S3_USE_AWS_MANAGED_IAM=false
# PLUGIN_S3_USE_AWS=false
# PLUGIN_S3_ENDPOINT=
# PLUGIN_S3_USE_PATH_STYLE=false
# PLUGIN_AWS_ACCESS_KEY=
# PLUGIN_AWS_SECRET_KEY=
# PLUGIN_AWS_REGION=
# PLUGIN_AZURE_BLOB_STORAGE_CONTAINER_NAME=
# PLUGIN_AZURE_BLOB_STORAGE_CONNECTION_STRING=
# PLUGIN_TENCENT_COS_SECRET_KEY=
# PLUGIN_TENCENT_COS_SECRET_ID=
# PLUGIN_TENCENT_COS_REGION=
# PLUGIN_ALIYUN_OSS_REGION=
# PLUGIN_ALIYUN_OSS_ENDPOINT=
# PLUGIN_ALIYUN_OSS_ACCESS_KEY_ID=
# PLUGIN_ALIYUN_OSS_ACCESS_KEY_SECRET=
# PLUGIN_ALIYUN_OSS_AUTH_VERSION=v4
# PLUGIN_ALIYUN_OSS_PATH=
# PLUGIN_VOLCENGINE_TOS_ENDPOINT=
# PLUGIN_VOLCENGINE_TOS_ACCESS_KEY=
# PLUGIN_VOLCENGINE_TOS_SECRET_KEY=
# PLUGIN_VOLCENGINE_TOS_REGION=

# ------------------------------
# Dify Application URLs (Update these for your domain)
# ------------------------------
CONSOLE_API_URL=https://dify.hyper-typer.xyz/console/api
CONSOLE_WEB_URL=https://dify.hyper-typer.xyz/console
SERVICE_API_URL=https://dify.hyper-typer.xyz/v1
APP_API_URL=https://dify.hyper-typer.xyz/v1
APP_WEB_URL=https://dify.hyper-typer.xyz/app

# ------------------------------
# Security Configuration
# ------------------------------
SECRET_KEY=sk-9f73s3ljTXVcMT3Blb3ljTqtsKiGHXVcMT3BlbkFJLK7U
INIT_PASSWORD=your-admin-password-here

# Generate a strong secret key: openssl rand -base64 42
# Generate a strong admin password and set it here

# ------------------------------
# Logging Configuration
# ------------------------------
LOG_LEVEL=INFO
DEBUG=false
FLASK_DEBUG=false

# ------------------------------
# Nginx Configuration
# ------------------------------
NGINX_SERVER_NAME=dify.hyper-typer.xyz
NGINX_HTTPS_ENABLED=true
NGINX_PORT=80
NGINX_SSL_PORT=443
NGINX_SSL_CERT_FILENAME=dify.crt
NGINX_SSL_CERT_KEY_FILENAME=dify.key
NGINX_SSL_PROTOCOLS=TLSv1.1 TLSv1.2 TLSv1.3
NGINX_WORKER_PROCESSES=auto
NGINX_CLIENT_MAX_BODY_SIZE=100M
NGINX_KEEPALIVE_TIMEOUT=65
NGINX_PROXY_READ_TIMEOUT=3600s
NGINX_PROXY_SEND_TIMEOUT=3600s
NGINX_ENABLE_CERTBOT_CHALLENGE=false
CERTBOT_DOMAIN=dify.hyper-typer.xyz
CERTBOT_EMAIL=admin@dify.hyper-typer.xyz

# ------------------------------
# API Configuration
# ------------------------------
DIFY_BIND_ADDRESS=0.0.0.0
DIFY_PORT=5001
SERVER_WORKER_AMOUNT=1
SERVER_WORKER_CLASS=gevent
SERVER_WORKER_CONNECTIONS=10
GUNICORN_TIMEOUT=360
CELERY_WORKER_AMOUNT=1
CELERY_AUTO_SCALE=false
CELERY_MAX_WORKERS=3
CELERY_MIN_WORKERS=1
CELERY_WORKER_CLASS=

# ------------------------------
# File Storage Configuration
# ------------------------------
STORAGE_TYPE=opendal
OPENDAL_SCHEME=fs
OPENDAL_FS_ROOT=storage
FILES_ACCESS_TIMEOUT=300
UPLOAD_FILE_SIZE_LIMIT=15
UPLOAD_FILE_BATCH_LIMIT=5
UPLOAD_IMAGE_FILE_SIZE_LIMIT=10
UPLOAD_VIDEO_FILE_SIZE_LIMIT=100
UPLOAD_AUDIO_FILE_SIZE_LIMIT=50

# ------------------------------
# Vector Store Configuration
# ------------------------------
VECTOR_STORE=weaviate
WEAVIATE_ENDPOINT=http://weaviate:8080
WEAVIATE_API_KEY=WVF5YThaHlkYwhGUSmCRgsX3tD5ngdN8pkih

# Alternative vector stores (uncomment to use)
# QDRANT_URL=http://qdrant:6333
# QDRANT_API_KEY=difyai123456
# MILVUS_URI=http://milvus:19530
# MILVUS_TOKEN=
# PGVECTOR_HOST=pgvector
# PGVECTOR_PORT=5432
# PGVECTOR_USER=postgres
# PGVECTOR_PASSWORD=difyai123456
# PGVECTOR_DATABASE=dify

# ------------------------------
# External API Configuration
# ------------------------------
OPENAI_API_BASE=https://api.openai.com/v1

# ------------------------------
# Monitoring and Observability
# ------------------------------
SENTRY_DSN=
API_SENTRY_DSN=
WEB_SENTRY_DSN=
PLUGIN_SENTRY_DSN=

# ------------------------------
# Mail Configuration
# ------------------------------
MAIL_TYPE=resend
MAIL_DEFAULT_SEND_FROM=
RESEND_API_URL=https://api.resend.com
RESEND_API_KEY=
SMTP_SERVER=
SMTP_PORT=465
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_USE_TLS=true
SMTP_OPPORTUNISTIC_TLS=false
SENDGRID_API_KEY=

# ------------------------------
# Workflow Configuration
# ------------------------------
WORKFLOW_MAX_EXECUTION_STEPS=500
WORKFLOW_MAX_EXECUTION_TIME=1200
WORKFLOW_CALL_MAX_DEPTH=5
MAX_VARIABLE_SIZE=204800
WORKFLOW_PARALLEL_DEPTH_LIMIT=3
WORKFLOW_FILE_UPLOAD_LIMIT=10
HTTP_REQUEST_NODE_MAX_BINARY_SIZE=10485760
HTTP_REQUEST_NODE_MAX_TEXT_SIZE=1048576
HTTP_REQUEST_NODE_SSL_VERIFY=True
LOOP_NODE_MAX_COUNT=100

# ------------------------------
# Code Execution Configuration
# ------------------------------
CODE_EXECUTION_ENDPOINT=http://sandbox:8194
CODE_EXECUTION_API_KEY=dify-sandbox
CODE_MAX_NUMBER=9223372036854775807
CODE_MIN_NUMBER=-9223372036854775808
CODE_MAX_DEPTH=5
CODE_MAX_PRECISION=20
CODE_MAX_STRING_LENGTH=80000
CODE_MAX_STRING_ARRAY_LENGTH=30
CODE_MAX_OBJECT_ARRAY_LENGTH=30
CODE_MAX_NUMBER_ARRAY_LENGTH=1000
CODE_EXECUTION_CONNECT_TIMEOUT=10
CODE_EXECUTION_READ_TIMEOUT=60
CODE_EXECUTION_WRITE_TIMEOUT=10

# ------------------------------
# Plugin Configuration
# ------------------------------
MAX_TOOLS_NUM=10
MAX_PARALLEL_LIMIT=10
MAX_ITERATIONS_NUM=99
MAX_TREE_DEPTH=50
TEXT_GENERATION_TIMEOUT_MS=60000
ALLOW_UNSAFE_DATA_SCHEME=false

# ------------------------------
# Frontend Configuration
# ------------------------------
NEXT_TELEMETRY_DISABLED=0
TEXT_GENERATION_TIMEOUT_MS=60000
CSP_WHITELIST=
ALLOW_EMBED=false
ALLOW_UNSAFE_DATA_SCHEME=false
MARKETPLACE_API_URL=https://marketplace.dify.ai
MARKETPLACE_URL=https://marketplace.dify.ai
TOP_K_MAX_VALUE=10
INDEXING_MAX_SEGMENTATION_TOKENS_LENGTH=4000
PM2_INSTANCES=2
ENABLE_WEBSITE_JINAREADER=true
ENABLE_WEBSITE_FIRECRAWL=true
ENABLE_WEBSITE_WATERCRAWL=true

# ------------------------------
# CORS Configuration
# ------------------------------
WEB_API_CORS_ALLOW_ORIGINS=https://dify.hyper-typer.xyz
CONSOLE_CORS_ALLOW_ORIGINS=https://dify.hyper-typer.xyz

# ------------------------------
# Additional Configuration
# ------------------------------
MIGRATION_ENABLED=true
CHECK_UPDATE_URL=https://updates.dify.ai
SCARF_NO_ANALYTICS=true
PROMPT_GENERATION_MAX_TOKENS=512
CODE_GENERATION_MAX_TOKENS=1024
PLUGIN_BASED_TOKEN_COUNTING_ENABLED=false
MULTIMODAL_SEND_FORMAT=base64
RESPECT_XFORWARD_HEADERS_ENABLED=false
SWAGGER_UI_ENABLED=true
SWAGGER_UI_PATH=/swagger-ui.html
DSL_EXPORT_ENCRYPT_DATASET_ID=true
ENABLE_CLEAN_EMBEDDING_CACHE_TASK=false
ENABLE_CLEAN_UNUSED_DATASETS_TASK=false
ENABLE_CREATE_TIDB_SERVERLESS_TASK=false
ENABLE_UPDATE_TIDB_SERVERLESS_STATUS_TASK=false
ENABLE_CLEAN_MESSAGES=false
ENABLE_MAIL_CLEAN_DOCUMENT_NOTIFY_TASK=false
ENABLE_DATASETS_QUEUE_MONITOR=false
ENABLE_CHECK_UPGRADABLE_PLUGIN_TASK=true
QUEUE_MONITOR_THRESHOLD=200
QUEUE_MONITOR_ALERT_EMAILS=
QUEUE_MONITOR_INTERVAL=30
CREATE_TIDB_SERVICE_JOB_ENABLED=false
MAX_SUBMIT_COUNT=100
TOP_K_MAX_VALUE=10
EXPOSURE_TIDB_API_KEY=
EXPOSURE_TIDB_API_URL=
EXPOSURE_TIDB_IAM_API_URL=
EXPOSURE_TIDB_REGION=
EXPOSURE_TIDB_PROJECT_ID=
EXPOSURE_TIDB_SPEND_LIMIT=100
POSITION_TOOL_PINS=
POSITION_TOOL_INCLUDES=
POSITION_TOOL_EXCLUDES=
POSITION_PROVIDER_PINS=
POSITION_PROVIDER_INCLUDES=
POSITION_PROVIDER_EXCLUDES=
